<html !DOCTYPE html>

<head>
    <script type='text/javascript' src='https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.5.2.min.js'></script>
    <link rel='stylesheet' type='text/css' href='include/LayoutMisc.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='include/ReducedStyle.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='include/ReducedStyle2.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='include/ReducedStyle3.css' xmlns='http://www.w3.org/1999/xhtml'>
    <link rel='stylesheet' type='text/css' href='include/DynamicStyle.css' xmlns='http://www.w3.org/1999/xhtml'>
</head>

<body style='margin:20px !important;'>

    <div id='theHeader'></div>

    <h1 class='post-name'>Azure Cognitive Services - Computer Vision - Image Recognition API - iSpy plug-in code example - TechNet Articles - United States (English) - TechNet Wiki</h1>
            
    <!-- AUTO ADDED ABOVE -->

    <div class="post-content user-defined-markup">




<div class="table-of-contents"><h2 class="title">Table of Contents</h2><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Introduction">Introduction</a></li><li class="hierarchy-item"><a href="#What_is_Azure_Cognitive_Services">What is Azure Cognitive Services?</a></li><li class="hierarchy-item"><a href="#What_is_an_API_and_how_do_you_use_it">What is an API and how do you use it?</a></li><li class="hierarchy-item"><a href="#A_Demonstration">A Demonstration</a></li><li class="hierarchy-item"><a href="#How_to_get_the_best_out_of_the_service">How to get the best out of the service</a></li><li class="hierarchy-item"><a href="#Further_Reading">Further Reading</a></li></ul><div class="hierarchy-list-footer"> </div></div><br />
<br />
<br />
<h1><a name="Introduction"></a>Introduction</h1>
<p><a href="https://azure.microsoft.com/en-gb/services/cognitive-services/">Azure Cognitive Services</a> provide some amazing machine learning API tools to add powerful analysis to your applications. All you need to do is register for an API key and you can
 get started straight away!</p>
<p>This article will show you how the &quot;Analyse&quot; API works and how easy it is to integrate.</p>
<p>To demonstrate, we will make a plug-in (class library) for the popular open source camera monitor software iSpy.</p>
<p>This article focuses on the API service. For more details on how to use the plug-in in iSpy, please read this write-up on MSDN, where the code is available, as well as on GitHub.</p>
<p>&nbsp;</p>
<h1><a name="What_is_Azure_Cognitive_Services"></a>What is Azure Cognitive Services?</h1>
<p>At the time of writing this, there are five amazing services that you can play with and use for FREE, up to a certain usage level.</p>
<p>We have collated the text from <strong><a href="https://azure.microsoft.com/en-gb/services/cognitive-services/">here</a></strong> into a single list below:</p>
<p><strong><a href="https://azure.microsoft.com/en-gb/services/cognitive-services/directory/vision/">Vision
</a></strong>- Image-processing algorithms to smartly identify, caption and moderate your pictures.</p>
<ul>
<li>Computer Vision API - Distill actionable information from images </li><li>Content moderator - Automated image, text and video moderation </li><li>Video API - Intelligent video processing </li><li>Video Indexer - Unlock video insights </li><li>Face API - Detect, identify, analyse, organised and tag faces in photos </li><li>Emotion API - Personalize user experiences with emotion recognition </li><li>Custom Vision Service - Easily customize your own state-of-the-art computer vision models for your unique use case
</li></ul>
<p><strong><a href="https://azure.microsoft.com/en-gb/services/cognitive-services/directory/speech/">Speech
</a></strong>- Convert spoken audio into text, use voice for verification or add speech recognition to your app.</p>
<ul>
<li>Computer Vision API - Distill actionable information from images </li><li>Translator Speech API - Easily conduct real-time speech translation with a simple REST API call
</li><li>Speaker Recognition API - Use speech to identify and authenticate individual speakers
</li><li>Bing Speech API - Convert speech to text and back again to understand user intent
</li><li>Custom Speech Service - Overcome speech recognition barriers like speaking style, background noise and vocabulary
</li></ul>
<p><strong><a href="https://azure.microsoft.com/en-gb/services/cognitive-services/directory/lang/">Language
</a></strong>- Allow your apps to process natural language with pre-built scripts, evaluate sentiment and learn how to recognize what users want.</p>
<ul>
<li>Language Understanding Intelligent Service - Teach your apps to understand commands from your users
</li><li>Bing Spell Check API - Detecting and correcting spelling mistakes in your app
</li><li>Web Language Model API - Use the power of predictive language models trained on web-scale data
</li><li>Text Analytics API - Easily evaluate sentiment and topics to understand what users want
</li><li>Translator Text API - Easily conduct machine translation with a simple REST API call
</li><li>Web Language Model API - Use the power of predictive language models trained on web-scale data
</li><li>Linguistic Analysis API - Simplify complex language concepts and parse text with the Linguistic Analysis API
</li></ul>
<p><strong><a href="https://azure.microsoft.com/en-gb/services/cognitive-services/directory/know/">Knowledge
</a></strong>- Map complex information and data in order to solve tasks such as intelligent recommendations and semantic search.</p>
<ul>
<li>Recommendations API - Predict and recommend items your customers want </li><li>Academic Knowledge API - Tap into the wealth of academic content in the Microsoft Academic Graph
</li><li>Knowledge Exploration Service - Enable interactive search experiences over structured data via natural language inputs
</li><li>QnA Maker API - Distill information into conversational, easy-to-navigate answers
</li><li>Entity Linking Intelligence Service API - Power your appâ€™s data links with named entity recognition and disambiguation
</li><li>Custom Decision Service - A cloud-based, contextual decision-making API that sharpens with experience
</li></ul>
<p><strong><a href="https://azure.microsoft.com/en-gb/services/cognitive-services/directory/search/">Search
</a></strong>- Add Bing Search APIs to your apps and harness the ability to comb billions of web pages, images, videos and news with a single API call.</p>
<ul>
<li>Bing Autosuggest API - Give your app intelligent auto-suggest options for searches
</li><li>Bing Image Search API - Search for images and get comprehensive results </li><li>Bing News Search API - Search for news and get comprehensive results </li><li>Bing Video Search API - Search for videos and get comprehensive results </li><li>Bing Web Search API - Get enhanced search details from billions of web documents
</li><li>Bing Custom Search API - An easy-to-use, ad-free, commercial-grade search tool that lets you deliver the results you want
</li></ul>
<p>&nbsp;</p>
<h1><a name="What_is_an_API_and_how_do_you_use_it"></a>What is an API and how do you use it?</h1>
<p>API stands for Application Programming Interface. It is a bunch of web &quot;endpoints&quot; (URLs) that you can reach out to, just like a web browser request. But instead of returning an HTML page, you get JSON encoded data. You can then use this data in your own
 application.</p>
<p>For this demonstration, we have used the Computer Vision API. All you need to know to get started is
<a href="https://docs.microsoft.com/en-us/azure/cognitive-services/computer-vision/quickstarts/csharp">
<strong>HERE</strong></a>.</p>
<p>You will need to <a href="https://azure.microsoft.com/en-gb/try/cognitive-services/">
<strong>register with Cognitive Services</strong></a><strong></strong>, to obtain an instant API key.</p>
<p>Insert your key into the code shown in the link above and you&#39;re good to go!</p>
<p>&nbsp;</p>
<h1><a name="A_Demonstration"></a>A Demonstration</h1>
<p>We won&#39;t post too much code here. Just relevant bits and then refer you to the following sources, where we have posted everything you need to get up and running in minutes.</p>
<p><strong></strong><a href="https://code.msdn.microsoft.com/iSpy-Plugin-Azure-2edc2564"><strong>MSDN Samples</strong>
</a>has a copy of the project, with a good write-up on how to use it in iSpy</p>
<p><strong></strong><a href="https://github.com/ProjectPete/iSpy-Azure-Cognitive-Services-Computer-Vision"><strong>GitHub
</strong></a>also has a copy of the project. <strong>I&#39;d love it if you helped improve the code, or added to its features!</strong></p>
<p>To call the API, you simply need to send an HTTP POST request to the API endpoint, with your API key and the function parameters that you want.</p>
<p>Below is the important code snippet from that link above, plus an explanation of the important bits, below:</p>
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5707.CodeBits1.PNG"><img alt=" " src="https://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5707.CodeBits1.PNG" style="border:1px solid #000000;width:550px;height:532px;vertical-align:middle;" /></a><br />
<br />
<p>This method takes a file path as a parameter, but you can just as easily pass through images as byte streams, as we demonstrate in the MSDN/GitHub project.</p>
<p>This API function has a visual Features parameter, so you can reduce bandwidth by selecting only features you want.</p>
<p>The HTTP request header must have &quot;<strong>Ocp-Apim-Subscription-Key</strong>&quot;, with your API key. This authorizes your use of the API.</p>
<p>The response from the service is taken as a string, but it is actually JSON encoded data. How you then process it is up to you. Either with conversion to strongly typed objects, or as dynamic variables. For this quick demo, we show the latter method.</p>
<div class="reCodeBlock">
<div style="background-color:#ffffff;"><span><code style="color:#008200;">// Categories</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#006699;font-weight:bold;">if</code>
<code style="color:#000000;">(r.categories != </code><code style="color:#006699;font-weight:bold;">null</code><code style="color:#000000;">)</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">{</code></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">Newtonsoft.Json.Linq.JArray cats = r.categories;</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">foreach</code>
<code style="color:#000000;">(dynamic cat </code><code style="color:#006699;font-weight:bold;">in</code>
<code style="color:#000000;">cats)</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">var name = (</code><code style="color:#006699;font-weight:bold;">string</code><code style="color:#000000;">)cat.name;</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">report.Reports.Add($</code><code style="color:blue;">&quot;Category: {name} ({cat.score}))&quot;</code><code style="color:#000000;">);</code></span></span></div>
<div style="background-color:#ffffff;"><span>&nbsp;</span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#008200;">// Check for person</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code>
<code style="color:#000000;">(name.ToLower().Contains(</code><code style="color:blue;">&quot;people&quot;</code><code style="color:#000000;">))</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">report.HasPerson =
</code><code style="color:#006699;font-weight:bold;">true</code><code style="color:#000000;">;</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">}</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#006699;font-weight:bold;">else</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">{</code></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">report.Reports.Add(</code><code style="color:blue;">&quot;Uncategorised&quot;</code><code style="color:#000000;">);</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">}</code></span></div>
</div>
<br />
<br />
Above shows the returned &quot;categories&quot; property. <br />
<br />
We have found that when this has a person in it, it has so far always been correct.<br />
<br />
<span style="font-size:12.1px;"><br />
<div class="reCodeBlock">
<div style="background-color:#ffffff;"><span><code style="color:#008200;">// Tags</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#006699;font-weight:bold;">if</code>
<code style="color:#000000;">(r.description.tags != </code><code style="color:#006699;font-weight:bold;">null</code><code style="color:#000000;">)</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">{</code></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">var tags =
</code><code style="color:blue;">&quot;Tags: &quot;</code><code style="color:#000000;">;</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">foreach</code>
<code style="color:#000000;">(</code><code style="color:#006699;font-weight:bold;">string</code>
<code style="color:#000000;">tag </code><code style="color:#006699;font-weight:bold;">in</code>
<code style="color:#000000;">r.description.tags)</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">tags &#43;=
</code><code style="color:blue;">&quot;[&quot;</code> <code style="color:#000000;">&#43; tag &#43; </code>
<code style="color:blue;">&quot;] &quot;</code><code style="color:#000000;">;</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code>
<code style="color:#000000;">(tags.Length &gt; MaxTextCharWidth)</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">report.Reports.Add(tags);</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">tags =
</code><code style="color:blue;">&quot;&quot;</code><code style="color:#000000;">;</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div>
<div style="background-color:#ffffff;"><span>&nbsp;</span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#008200;">// Check for person</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code>
<code style="color:#000000;">(personTags.Contains(tag))</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">report.HasPerson =
</code><code style="color:#006699;font-weight:bold;">true</code><code style="color:#000000;">;</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code>
<code style="color:#000000;">(tags != </code><code style="color:blue;">&quot;&quot;</code><code style="color:#000000;">)</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">report.Reports.Add(tags);</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">}</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#006699;font-weight:bold;">else</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">{</code></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">report.Reports.Add(</code><code style="color:blue;">&quot;No tags&quot;</code><code style="color:#000000;">);</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">}</code></span></div>
</div>
<br />
<br />
Above shows the returned &quot;tags&quot; property.&nbsp;</span>
<p>This feature is quite chatty and random. <br />
<br />
It often comes back with one of the trigger words below.</p>
<div class="reCodeBlock">
<div style="background-color:#ffffff;"><span><code style="color:#006699;font-weight:bold;"></code>
<div class="reCodeBlock" style="border:1px solid #7f9db9;overflow-y:auto;">
<div style="background-color:#ffffff;"><span><code style="color:#000000;">static List&lt;</code><code style="color:#006699;font-weight:bold;">string</code><code style="color:#000000;">&gt; personTags = new List&lt;</code><code style="color:#006699;font-weight:bold;">string</code><code style="color:#000000;">&gt;
 { &quot;man&quot;, &quot;woman&quot;, &quot;person&quot;, &quot;people&quot;, &quot;boy&quot;, &quot;girl&quot; };</code></span></div>
</div>
<code style="color:#000000;"></code></span></div>
</div>
<br />
<br />
Finally, below is the returned &quot;captions&quot; property. <br />
<br />
This can often be uncannily accurate, but sometimes hilariously off the mark!
<div class="reCodeBlock">
<div style="background-color:#ffffff;"><span><code style="color:#008200;">// Captions</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#006699;font-weight:bold;">if</code>
<code style="color:#000000;">(r.description.captions != </code><code style="color:#006699;font-weight:bold;">null</code><code style="color:#000000;">)</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">{</code></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">report.Reports.Add(</code><code style="color:blue;">&quot;Captions: &quot;</code><code style="color:#000000;">);</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">foreach</code>
<code style="color:#000000;">(dynamic caption </code><code style="color:#006699;font-weight:bold;">in</code>
<code style="color:#000000;">r.description.captions)</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">report.Reports.Add($</code><code style="color:blue;">&quot;\&quot;{caption.text}\&quot; ({caption.confidence})&quot;</code><code style="color:#000000;">);</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">}</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#006699;font-weight:bold;">else</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">{</code></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">report.Reports.Add(</code><code style="color:blue;">&quot;No captions&quot;</code><code style="color:#000000;">);</code></span></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">}</code></span></div>
</div>
<br />
<br />
<h1><a name="How_to_get_the_best_out_of_the_service"></a>How to get the best out of the service</h1>
<p>If we just sent it the whole frame every time we wanted the doorstep analysis, I&#39;d quite often get the same reply back, about the surrounding scenery from the image. As this camera pointed to our front drive, we&#39;d often just get &quot;A close-up of a car&quot;, so
 not about the subject that was actually moving, beside the car.</p>
<p>So we need to add a way to crop just the relevant &quot;action window&quot; out of the image.</p>
<p>iSpy just provides raw frames to plugins, so we have to find the action window ourselves. In this case, this plug-in was a great test-bed to develop the code we would later use for a Windows Universal IP Camera app, which we can run on a Raspberry Pi.&nbsp;<span style="font-size:12.1px;">Therefore,
 I&#39;ve also added my own movement detection algorithm.&nbsp;</span></p>
<p>Added movement detection means the plug-in can be run in iSpy in &quot;continuous&quot; mode, completely replacing the built-in movement detection.<br />
<br />
<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7028.UsePlugin.PNG"><img alt=" " src="https://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7028.UsePlugin.PNG" style="border:1px solid #000000;width:493px;height:433px;" /></a></p>
<p>Here is a screenshot of the &quot;Configure&quot; pop-up, which highlights each step the plug-in takes.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1234.Bush.PNG"><img alt=" " src="https://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1234.Bush.PNG" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<br />
<br />
</p>
<p>1) Take the raw frames from the iSpy input stream</p>
<p>2) Reduce the raw frame to a much smaller number of pixels (pixelated)</p>
<p>3) Change the pixels to greyscale</p>
<p>4) Compare pixels to the last frame, highlight/count pixels that change</p>
<p>5) Detect shade changes that are more than the allowed sensitivity range</p>
<p>6) Calculate total percent of changed pixels between old and new pixelated frames</p>
<p>7) If percentage is within a trigger range (min/max), then trigger an alert</p>
<p>8) The actual &quot;action window&quot; is taken (rectangle containing the only area with movement, not the static scenery)</p>
<p>9) Send just that &quot;action window&quot; section of the image to Cognitive Services, for analysis!</p>
<p>10) Trigger alerts based on the category or tags that are returned!<br />
<br />
<br />
<br />
<span style="font-size:12.1px;">Below is the code that keeps track of the boundaries of the action window, while checking the pixels for change:<br />
<br />
</span></p>
<div class="reCodeBlock">
<div style="background-color:#ffffff;"><span><code style="color:#008200;">// Compare to last frame same pixel</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#006699;font-weight:bold;">try</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">{</code></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">var lastPixel = lastBmp.GetPixel(x, y);</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code>
<code style="color:#000000;">(avg &lt; lastPixel.R - sensitivity || avg &gt; lastPixel.R &#43; sensitivity)</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">changedPixels&#43;&#43;;</code></span></span></div>
<div style="background-color:#f8f8f8;"><span>&nbsp;</span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#008200;">// Determine action window boundaries</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code>
<code style="color:#000000;">(x &lt; imageToAnalyse.BoundaryStartPoint.X)</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">imageToAnalyse.BoundaryStartPoint.X = x;</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code>
<code style="color:#000000;">(x &gt; imageToAnalyse.BoundaryEndPoint.X)</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">imageToAnalyse.BoundaryEndPoint.X = x;</code></span></span></div>
<div style="background-color:#f8f8f8;"><span>&nbsp;</span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code>
<code style="color:#000000;">(y &lt; imageToAnalyse.BoundaryStartPoint.Y)</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">imageToAnalyse.BoundaryStartPoint.Y = y;</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">if</code>
<code style="color:#000000;">(y &gt; imageToAnalyse.BoundaryEndPoint.Y)</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">imageToAnalyse.BoundaryEndPoint.Y = y;</code></span></span></div>
<div style="background-color:#ffffff;"><span>&nbsp;</span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">imageToAnalyse.ChangeThumbnail.SetPixel(x, y, Color.Red);</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">}</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#006699;font-weight:bold;">catch</code>
<code style="color:#000000;">(Exception exc)</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">{</code></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">Logger.LogError(exc);</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">}</code></span></div>
</div>
<p><span style="font-size:12.1px;"><br />
<br />
It is then just a matter of clipping out the action window from the frame into a new Bitmap, which</span><span style="font-size:12.1px;">we can then send to Cognitive Services.</span></p>
<div class="reCodeBlock">
<div style="background-color:#ffffff;"><span><code style="color:#006699;font-weight:bold;">public</code>
<code style="color:#006699;font-weight:bold;">static</code> <code style="color:#006699;font-weight:bold;">
void</code> <code style="color:#000000;">CopyRegionIntoImage(Bitmap srcBitmap, Rectangle srcRegion,
</code><code style="color:#006699;font-weight:bold;">ref</code> <code style="color:#000000;">
Bitmap destBitmap, Rectangle destRegion)</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">{</code></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#006699;font-weight:bold;">using</code>
<code style="color:#000000;">(Graphics grD = Graphics.FromImage(destBitmap))</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">{</code></span></span></div>
<div style="background-color:#ffffff;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">grD.DrawImage(srcBitmap, destRegion, srcRegion, GraphicsUnit.Pixel);</code></span></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">}</code></span></div>
</div>
<br />
<br />
<h1><a name="Further_Reading"></a>Further Reading</h1>
<p><a href="https://www.ispyconnect.com/">iSpy Connect</a>&nbsp;- The home of iSpy, with free installer and extra online services (paid upgrade)</p>
<p><a href="https://azure.microsoft.com/en-gb/services/cognitive-services/computer-vision/">Microsoft Cognitive Services</a>&nbsp;- Where the magic happens! FREE registration and allowance of x number of calls per minute/month.</p>
<p><a href="https://azure.microsoft.com/en-gb/try/cognitive-services/?api=emotion-api">Get a FREE API key</a>&nbsp;-&nbsp;Start analyzing within minutes!</p>
<p><a href="http://www.ispyconnect.com/plugins.aspx">iSpy Plugins</a>&nbsp;- Tutorial and downloadable code, showing how to make your own iSpy plug-in</p>
<p><a href="https://github.com/ProjectPete/iSpy-Azure-Cognitive-Services-Computer-Vision">This plug-in on GitHub</a> -
<strong>Sharing is caring!</strong> If you like this, take it further or find a bug/improvement, please add to the repo!</p>

</div>
    
    

    <!-- AUTO ADDED BELOW -->

    <div id='theFooter'></div>

    <script type='text/javascript'>
    
        var headerContainer = jQuery('#theHeader');
        jQuery.ajax({
            url: 'include/GitHubPagesWikiHeader.html',
            success: function (data) {
                headerContainer.html(data);
            }
        });

        var footerContainer = jQuery('#theFooter');
        jQuery.ajax({
            url: 'include/GitHubPagesWikiFooter.html',
            success: function (data) {
                footerContainer.html(data);
            }
        });       

    </script>
</body>

</html>