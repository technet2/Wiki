---
layout: default
title: 'Blackboard Design Pattern&#58; A Practical Example - Radar Defense System - TechNet Articles - United States (English) - TechNet Wiki'
weight: 3
---

<div class="post-content user-defined-markup">

<strong>This article&nbsp;presents a WPF C# example of the Blackboard design pattern, available on TechNet Gallery.
<br />
<br />
<a href="http://gallery.technet.microsoft.com/Blackboard-Design-Pattern-13a35a7e"><strong><span style="font-size:14px;">http://gallery.technet.microsoft.com/Blackboard-Design-Pattern-13a35a7e</span></strong></a><a name="The_Concepts2"></a><br />
<br />
It discusses the concepts of the design pattern, and highlights points of interest for C#, WPF developers.</strong><br />
<br />
<div class="table-of-contents"><h2 class="title">Table of Contents</h2><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Introduction">Introduction</a></li><li class="hierarchy-item"><a href="#The_Concepts">The Concepts</a></li><li class="hierarchy-item"><a href="#The_Project">The Project</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#MainWindow_xaml">MainWindow</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#The_ListBox">The ListBox</a></li><li class="hierarchy-item"><a href="#The_Item_Container">The Item Container</a></li><li class="hierarchy-item"><a href="#The_Item">The Item</a></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#Code_Behind_ViewModel">Code Behind / ViewModel</a></li><li class="hierarchy-item"><a href="#IObject_BirdObject_PlaneObject_RocketObject">IObject, BirdObject, PlaneObject, RocketObject, ObjectBase</a></li><li class="hierarchy-item"><a href="#Incoming_Object">Incoming Object</a></li><li class="hierarchy-item"><a href="#Knowledge_Sources">Knowledge Sources</a></li><li class="hierarchy-item"><a href="#Signal_Processor">Signal Processor</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Copying_Betwen_WriteableBitmaps">Copying Between WriteableBitmaps</a></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#Image_Recognition">Image Recognition</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Comparing_Pixels">Comparing Pixels</a></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#Plane_Identification">Plane Identification</a></li><li class="hierarchy-item"><a href="#The_War_Machine">The War Machine!</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Drawing_on_a_WriteableBitmap">Drawing on a WriteableBitmap</a></li></ul><div class="hierarchy-list-footer"> </div></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#Blackboard_Extensibility">Blackboard Extensibility</a></li><li class="hierarchy-item"><a href="#Download_and_Try">Download and Try!</a></li><li class="hierarchy-item"><a href="#See_Also">See Also</a></li></ul><div class="hierarchy-list-footer"> </div></div><br />
<h1><a name="Introduction"></a>Introduction</h1>
<br />
The&nbsp;<a href="http://social.technet.microsoft.com/wiki/contents/articles/13215.blackboard-design-pattern.aspx">Blackboard pattern</a> is a
<a href="http://social.technet.microsoft.com/wiki/contents/articles/13461.blackboard-design-pattern-a-practical-example-radar-defense-system/edit.aspx">
design pattern</a>, used in software engineering, to coordinate separate, disparate systems that need to work together, or in sequence, continually prioritizing the actors (or knowledge sources).<br />
<br />
The blackboard consists of a number of stores or &quot;global variables&quot;, like a repository of messages, which can be accessed by separate autonomous processes, which could potentially be physically separate. A &quot;controller&quot; monitors the properties on the blackboard
 and decides which actors (or knowledge sources) to prioritize.<br />
<br />
The&nbsp;first five years of my 22 year career were spent in military radar detection and civil aviation. Radar data is enormous and it&nbsp;needs to be processed into something that can be analyzed in &quot;real-time&quot;.
<br />
<br />
The biggest job by far was simply converting the colossal amount of radar data into computer data, which would be split over multi-processors - hundreds or thousands of individual processors, each&nbsp;analyzing their own part of the spectrum. Converting &quot;real time&quot;,
 constantly incoming, raw radar data into usable computer data is by far the most processor intensive operation of this system. In my day we used multi-processors (hundreds/thousands of individually wired processors in racks in military vehicles or sprawling
 processor rooms. We even used a specialized language called&nbsp;<a href="http://en.wikipedia.org/wiki/RTL2">RTL2</a> and&nbsp;<a href="http://en.wikipedia.org/wiki/Motorola_68000">M68000</a> &quot;machine code inserts&quot; (snippets of manually crafted machine code) , to process
 in real time, where every processor cycle counted.<br />
<br />
As the data was coming in with increasing granularity, so we could start analyzing the data for patterns. As patterns emerged, they could be checked against known patterns until a small set of possibilities remained.
<br />
<br />
Then other processes could test the data or actual target further until a consensus between actors (or knowledge bases)&nbsp;was reached. Finally, the result would be acted upon, like an indicator in an output console, showing a plane on it&#39;s flight path, collision
 warnings, threat warnings, etc.<br />
<br />
This of course sounds very similar to the Blackboard pattern, so I decided to share this project with you to demonstrate some of the concepts.<br />
<br />
<a href="http://gallery.technet.microsoft.com/Blackboard-Design-Pattern-13a35a7e"><strong><span style="font-size:14px;">http://gallery.technet.microsoft.com/Blackboard-Design-Pattern-13a35a7e</span></strong></a><a name="The_Concepts3"></a>
<br />
&nbsp;<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/4657.titleimage.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/482x0/__key/communityserver-wikis-components-files/00-00-00-00-05/4657.titleimage.png" style="border-width:0px;border-style:solid;" /></a><br />
<p>&nbsp;</p>
<p>↑ <a href="#Top">Return to Top</a></p>
<hr />
<h1><a name="The_Concepts"></a>The Concepts</h1>
<p>In this example,&nbsp;the&nbsp;controller runs in a loop, iterating&nbsp;over all the Knowledge Sources that are active, and executing each.
<br />
<br />
The Blackboard Pattern defines the controller as the decision maker, as to WHICH Knowledge Source to execute and in what order. In this project that is represented simply by a &quot;Priority&quot; enum which orders the Knowledge Sources. For example the WarMachine is
 top priority and executed first, so any known&nbsp;threats are acted upon, before any decisions are made.<br />
<br />
The Blackboard Pattern&nbsp;states that&nbsp;each Knowledge Source is responsible for declaring whether it is available for the current state of the problem being analyzed. This could in fact be an autonomous process, as the Knowledge Sources could monitor the Blackboard
 directly, but in this example there are multiple problems (detected objects) being analyzed, so each Knowledge Source has an IsEnabled property, which is set if there are any valid objects on the Blackboard.<br />
<br />
The Blackboard Pattern declares that the controller iterates over the Knowledge Sources, each taking their turn at the problem. As this is a multi-problem Blackboard, I decided to stick as closely to the original concept and&nbsp;let each active Knowledge Source
 iterate over all the problems/objects that meet it&#39;s execution criteria.<br />
<br />
Some descriptions of the Blackboard Pattern include a callback delegate method, which the controller would then act upon to select the next best problem solver (Knowledge Base). There is a good argument that each of these modules could be working autonomously,
 and reporting back any changes that are needed. This would be a change to the controller concept of the Blackboard Pattern, so I stuck to a flat turn-based system. The only exception being the Radar module, as it is more of an &quot;input&quot; for the Blackboard, rather
 than an &quot;actor&quot; on the data.</p>
<p>&nbsp;</p>
<p>↑ <a href="#Top">Return to Top</a></p>
<hr />
<h1><a name="The_Project"></a>The Project</h1>
<br />
This document describes the project available for download at TechNet Gallery<br />
<br />
<a href="http://gallery.technet.microsoft.com/Blackboard-Design-Pattern-13a35a7e"><strong><span style="font-size:14px;">http://gallery.technet.microsoft.com/Blackboard-Design-Pattern-13a35a7e</span></strong></a><br />
&nbsp;<br />
<h2><a name="MainWindow_xaml"></a><strong>MainWindow</strong></h2>
<br />
The project only has one user interface, which presents the Blackboard data as a visual representation of the objects being analyzed.<br />
&nbsp;<br />
<h3><a name="The_ListBox"></a><strong>The ListBox</strong></h3>
<br />
In MainWindow.xaml is a simple ListBox. However, the ItemsPanel has been converted into a Canvas for it&#39;s ItemsHost, so that items can be positioned by X &amp; Y, rather than just a list.
<br />
<br />
<div class="reCodeBlock">
<div><span><code>&lt;</code><code style="font-weight:bold;">ListBox</code>
<code>ItemsSource</code><code>=</code><code style="color:blue;">&quot;{Binding blackboard.CurrentObjects}&quot;</code>
<code>ItemsPanel</code><code>=</code><code style="color:blue;">&quot;{DynamicResource ItemsPanelTemplate1}&quot;</code>
<code>ItemContainerStyle</code><code>=</code><code style="color:blue;">&quot;{DynamicResource ItemContainerStyle}&quot;</code>
<code>ItemTemplate</code><code>=</code><code style="color:blue;">&quot;{DynamicResource ItemTemplate}&quot;</code>
<code>Margin</code><code>=</code><code style="color:blue;">&quot;20,20,20,10&quot;</code>
<code>Foreground</code><code>=</code><code style="color:blue;">&quot;#FFDE6C6C&quot;</code>
<code>&gt;</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">ListBox.Resources</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">ItemsPanelTemplate</code>
<code>x:Key</code><code>=</code><code style="color:blue;">&quot;ItemsPanelTemplate1&quot;</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Canvas</code>
<code>IsItemsHost</code><code>=</code><code style="color:blue;">&quot;True&quot;</code><code>/&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;/</code><code style="font-weight:bold;">ItemsPanelTemplate</code><code>&gt;</code></span></span></div>
</div>
<p>&nbsp;</p>
<h3><a name="The_Item_Container"></a><strong>The Item Container</strong></h3>
<br />
The ItemContainer is used for positioning (Canvas.Left &amp; Canvas.Top), NOT the ItemTemplate itself.<br />
&nbsp;<br />
<div class="reCodeBlock">
<div><span><code>&lt;</code><code style="font-weight:bold;">Style</code>
<code>x:Key</code><code>=</code><code style="color:blue;">&quot;ItemContainerStyle&quot;</code>
<code>TargetType</code><code>=</code><code style="color:blue;">&quot;{x:Type ListBoxItem}&quot;</code><code>&gt;</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Setter</code>
<code>Property</code><code>=</code><code style="color:blue;">&quot;Background&quot;</code>
<code>Value</code><code>=</code><code style="color:blue;">&quot;Transparent&quot;</code><code>/&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Setter</code>
<code>Property</code><code>=</code><code style="color:blue;">&quot;HorizontalContentAlignment&quot;</code>
<code>Value</code><code>=</code><code style="color:blue;">&quot;{Binding HorizontalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}&quot;</code><code>/&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Setter</code>
<code>Property</code><code>=</code><code style="color:blue;">&quot;VerticalContentAlignment&quot;</code>
<code>Value</code><code>=</code><code style="color:blue;">&quot;{Binding VerticalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}&quot;</code><code>/&gt;</code></span></span></div>
<div><span><strong><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Setter</code>
<code>Property</code><code>=</code><code style="color:blue;">&quot;Canvas.Left&quot;</code>
<code>Value</code><code>=</code><code style="color:blue;">&quot;{Binding X}&quot;</code><code>/&gt;</code></span></strong></span></div>
<div><span><strong><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Setter</code>
<code>Property</code><code>=</code><code style="color:blue;">&quot;Canvas.Top&quot;</code>
<code>Value</code><code>=</code><code style="color:blue;">&quot;{Binding Y}&quot;</code><code>/&gt;</code></span></strong></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Setter</code>
<code>Property</code><code>=</code><code style="color:blue;">&quot;Template&quot;</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Setter.Value</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">ControlTemplate</code>
<code>TargetType</code><code>=</code><code style="color:blue;">&quot;{x:Type ListBoxItem}&quot;</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Border</code>
<code>x:Name</code><code>=</code><code style="color:blue;">&quot;Bd&quot;</code>
<code>BorderBrush</code><code>=</code><code style="color:blue;">&quot;{TemplateBinding BorderBrush}&quot;</code>
<code>BorderThickness</code><code>=</code><code style="color:blue;">&quot;{TemplateBinding BorderThickness}&quot;</code>
<code>Background</code><code>=</code><code style="color:blue;">&quot;{TemplateBinding Background}&quot;</code>
<code>Padding</code><code>=</code><code style="color:blue;">&quot;{TemplateBinding Padding}&quot;</code>
<code>SnapsToDevicePixels</code><code>=</code><code style="color:blue;">&quot;true&quot;</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">ContentPresenter</code>
<code>HorizontalAlignment</code><code>=</code><code style="color:blue;">&quot;{TemplateBinding HorizontalContentAlignment}&quot;</code>
<code>SnapsToDevicePixels</code><code>=</code><code style="color:blue;">&quot;{TemplateBinding SnapsToDevicePixels}&quot;</code>
<code>VerticalAlignment</code><code>=</code><code style="color:blue;">&quot;{TemplateBinding VerticalContentAlignment}&quot;</code><code>/&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;/</code><code style="font-weight:bold;">Border</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;/</code><code style="font-weight:bold;">ControlTemplate</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;/</code><code style="font-weight:bold;">Setter.Value</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;/</code><code style="font-weight:bold;">Setter</code><code>&gt;</code></span></span></div>
<div><span><code>&lt;/</code><code style="font-weight:bold;">Style</code><code>&gt;</code></span></div>
</div>
<p>&nbsp;</p>
<h3><a name="The_Item"></a><strong>The Item</strong></h3>
<br />
The <strong>ItemTemplate</strong> defines the object, just an <strong>Image</strong> and a couple of
<strong>TextBoxes</strong>, all wrapped in a colour-changing <strong>Border</strong> (for safe or threat).
<br />
<br />
There is also a countdown <strong>TextBlock</strong> for DistanceFromDestruction, which counts down until the War Machine (planes, missiles) reaches any targets identified as threats.<br />
<br />
<div class="reCodeBlock">
<div><span><code>&lt;</code><code style="font-weight:bold;">DataTemplate</code>
<code>x:Key</code><code>=</code><code style="color:blue;">&quot;ItemTemplate&quot;</code><code>&gt;</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Border</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Border.Style</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Style</code>
<code>TargetType</code><code>=</code><code style="color:blue;">&quot;{x:Type Border}&quot;</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Style.Triggers</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">DataTrigger</code>
<code>Binding</code><code>=</code><code style="color:blue;">&quot;{Binding IsThreat}&quot;</code>
<code>Value</code><code>=</code><code style="color:blue;">&quot;true&quot;</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Setter</code>
<code>Property</code><code>=</code><code style="color:blue;">&quot;Background&quot;</code>
<code>Value</code><code>=</code><code style="color:blue;">&quot;Red&quot;</code><code>/&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;/</code><code style="font-weight:bold;">DataTrigger</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">DataTrigger</code>
<code>Binding</code><code>=</code><code style="color:blue;">&quot;{Binding IsThreat}&quot;</code>
<code>Value</code><code>=</code><code style="color:blue;">&quot;false&quot;</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Setter</code>
<code>Property</code><code>=</code><code style="color:blue;">&quot;Background&quot;</code>
<code>Value</code><code>=</code><code style="color:blue;">&quot;Green&quot;</code><code>/&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;/</code><code style="font-weight:bold;">DataTrigger</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;/</code><code style="font-weight:bold;">Style.Triggers</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;/</code><code style="font-weight:bold;">Style</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;/</code><code style="font-weight:bold;">Border.Style</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Grid</code>
<code>Margin</code><code>=</code><code style="color:blue;">&quot;3&quot;</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">Image</code>
<code>Height</code><code>=</code><code style="color:blue;">&quot;48&quot;</code>
<code>Source</code><code>=</code><code style="color:blue;">&quot;{Binding Image}&quot;</code>
<code>/&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">StackPanel</code>
<code>Margin</code><code>=</code><code style="color:blue;">&quot;0,0,0,-30&quot;</code>
<code>VerticalAlignment</code><code>=</code><code style="color:blue;">&quot;Bottom&quot;</code>
<code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">TextBlock</code>
<code>Text</code><code>=</code><code style="color:blue;">&quot;{Binding Type}&quot;</code><code>/&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">TextBlock</code>
<code>Text</code><code>=</code><code style="color:blue;">&quot;{Binding Name}&quot;</code><code>/&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;/</code><code style="font-weight:bold;">StackPanel</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;</code><code style="font-weight:bold;">TextBlock</code>
<code>HorizontalAlignment</code><code>=</code><code style="color:blue;">&quot;Right&quot;</code>
<code>TextWrapping</code><code>=</code><code style="color:blue;">&quot;Wrap&quot;</code>
<code>Text</code><code>=</code><code style="color:blue;">&quot;{Binding DistanceFromDestruction}&quot;</code>
<code>VerticalAlignment</code><code>=</code><code style="color:blue;">&quot;Bottom&quot;</code>
<code>Width</code><code>=</code><code style="color:blue;">&quot;Auto&quot;</code>
<code>Visibility</code><code>=</code><code style="color:blue;">&quot;{Binding IsThreat, Converter={StaticResource BooleanToVisibilityConverter}}&quot;</code><code>/&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;/</code><code style="font-weight:bold;">Grid</code><code>&gt;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>&lt;/</code><code style="font-weight:bold;">Border</code><code>&gt;</code></span></span></div>
<div><span><code>&lt;/</code><code style="font-weight:bold;">DataTemplate</code><code>&gt;</code></span></div>
</div>
<h2><a name="Code_Behind_ViewModel"></a><strong>Code Behind / ViewModel</strong></h2>
&nbsp;<br />
The code behind simply instantiates the <strong>Controller</strong> and <strong>Blackboard</strong> components, and sets itself as DataContext (for any bindings) -&nbsp;the code-behind thereby acting a bit like a lazy MVVM&nbsp;ViewModel implementation.<br />
<br />
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">public</code>
<code>Blackboard blackboard { </code><code style="font-weight:bold;">get</code><code>;
</code><code style="font-weight:bold;">set</code><code>; }</code></span></div>
<div><span><code>Controller controller;</code></span></div>
<div><span>&nbsp;</span></div>
<div><span><code style="font-weight:bold;">public</code>
<code>MainWindow()</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>InitializeComponent();</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>DataContext =
</code><code style="font-weight:bold;">this</code><code>;</code></span></span></div>
<div><span>&nbsp;</span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>blackboard =
</code><code style="font-weight:bold;">new</code> <code>
Blackboard();</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>controller =
</code><code style="font-weight:bold;">new</code> <code>
Controller(blackboard);</code></span></span></div>
<div><span>&nbsp;</span></div>
<div><span><code>}</code></span></div>
</div>
<br />
As&nbsp;mentioned above, the signal processing part of the application is the most time consuming, and when you run the application, you will notice some objects reach the top of the screen before they are identified.&nbsp;One good&nbsp;reason to use this pattern is it&#39;s
 extensibility, as you can bold extra modules on with ease, even as it is running. To demonstrate this, a button calls a method in the constructor top add extra Signal Processors, which obviously improves the speed objects are&nbsp;identified.<br />
<br />
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">private</code>
<code style="font-weight:bold;">void</code> <code>
Button_Click(</code><code style="font-weight:bold;">object</code>
<code>sender, System.Windows.RoutedEventArgs e)</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>controller.AddSignalProcessor();</code></span></span></div>
<div><span><code>}</code></span></div>
</div>
<br />
<h2><a name="IObject_BirdObject_PlaneObject_RocketObject"></a><strong>IObject, BirdObject, PlaneObject, RocketObject, ObjectBase</strong></h2>
<br />
As all objects that are captured by the radar can have the same set of properties (name, x, y) there is a base class called
<strong>IObject</strong>:<br />
<br />
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">public</code>
<code style="font-weight:bold;">interface</code> <code>
IObject</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>ObjectType Type {
</code><code style="font-weight:bold;">get</code><code>;
</code><code style="font-weight:bold;">set</code><code>; }</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">string</code>
<code>Name { </code><code style="font-weight:bold;">get</code><code>;
</code><code style="font-weight:bold;">set</code><code>; }</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>WriteableBitmap Image {
</code><code style="font-weight:bold;">get</code><code>;
</code><code style="font-weight:bold;">set</code><code>; }</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">bool</code><code>? IsThreat {
</code><code style="font-weight:bold;">get</code><code>;
</code><code style="font-weight:bold;">set</code><code>; }</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>ProcessingStage Stage {
</code><code style="font-weight:bold;">get</code><code>;
</code><code style="font-weight:bold;">set</code><code>; }</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">int</code>
<code>X { </code><code style="font-weight:bold;">get</code><code>;
</code><code style="font-weight:bold;">set</code><code>; }</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">int</code>
<code>Y { </code><code style="font-weight:bold;">get</code><code>;
</code><code style="font-weight:bold;">set</code><code>; }</code></span></span></div>
<div><span>&nbsp;</span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>IObject Clone();</code></span></span></div>
<div><span><code>}</code></span></div>
</div>
<br />
Bird, Plane &amp; RocketObject represent the three object types we can detect, but to save time, they all derive from ObjectBase and I define them in the Radar module:<br />
<br />
<div class="reCodeBlock">
<div><span><code>AllObjects = new List&lt;</code><code style="font-weight:bold;">IObject</code><code>&gt;</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>new BirdObject(ObjectType.Bird, &quot;&quot;, new WriteableBitmap(new System.Windows.Media.Imaging.BitmapImage(new Uri(@&quot;<a>pack://application</a>:,,,/Media/Bird.bmp&quot;,
 UriKind.Absolute))), false, false),</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>new PlaneObject(ObjectType.Plane, &quot;&quot;, new WriteableBitmap(new System.Windows.Media.Imaging.BitmapImage(new Uri(@&quot;<a>pack://application</a>:,,,/Media/Plane.bmp&quot;,
 UriKind.Absolute))), false, false),</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>new RocketObject(ObjectType.Rocket, &quot;&quot;, new WriteableBitmap(new System.Windows.Media.Imaging.BitmapImage(new Uri(@&quot;<a>pack://application</a>:,,,/Media/Rocket.bmp&quot;,
 UriKind.Absolute))), false, false),</code></span></span></div>
<div><span><code>};</code></span></div>
</div>
<br />
This is a little lazy&nbsp;I admit, as each object could encapsulate it&#39;s own data, but this&nbsp;small project is not design best practice, just design pattern concept ;)<br />
<br />
So we have&nbsp;different objects and their known images. if you look at the images you will see they are similar, but slightly different:<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6266.birdplanerocket.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6266.birdplanerocket.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<h2><a name="Incoming_Object"></a><strong>Incoming Object</strong></h2>
<br />
Once an object is &quot;detected&quot; by the Radar module, a new IncomingObject is added to the Blackboard&#39;s&nbsp;CurrentObjects collection. The actual object is hidden in a private property of the IncomingObject, which the Knowledge Sources will interrogate, to simulate
 the process of detection, analysis, identification and potentially it&#39;s destruction!<br />
<br />
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">public</code>
<code>IncomingObject(IObject obj)</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>:
</code><code style="font-weight:bold;">base</code><code>(ObjectType.Unknown,
</code><code style="font-weight:bold;">null</code><code>,
</code><code style="font-weight:bold;">null</code><code>,
</code><code style="font-weight:bold;">true</code><code>,
</code><code style="font-weight:bold;">null</code><code>)</code></span></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>actualObject = obj;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>ProcessedPixels =
</code><code style="font-weight:bold;">new</code> <code style="font-weight:bold;">
bool</code><code>[16, 16];</code></span></span></div>
<div><span>&nbsp;</span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>//Paint the image as all red to start with</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>Image =
</code><code style="font-weight:bold;">new</code> <code>
WriteableBitmap(48, 48, 72, 72, PixelFormats.Bgr32, </code><code style="font-weight:bold;">null</code><code>);</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">int</code><code>[] ary =
</code><code style="font-weight:bold;">new</code> <code style="font-weight:bold;">
int</code><code>[(48 * 48)];</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">for</code>
<code>(var x = 0; x &lt; 48; x&#43;&#43;)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">for</code>
<code>(var y = 0; y &lt; 48; y&#43;&#43;)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>ary[48 * y &#43; x] = 255 * 256 * 256;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>Image.WritePixels(</code><code style="font-weight:bold;">new</code>
<code>Int32Rect(0, 0, 48, 48), ary, 4 * 48, 0); </code></span></span></div>
<div><span><code>}</code></span></div>
</div>
<br />
As shown, the &quot;known image&quot; begins as red, as it has not been processed at all yet.<br />
<br />
<h2><a name="Knowledge_Sources"></a><strong>Knowledge Sources</strong></h2>
<br />
Knowledge Sources represent the brains of the system, each specializing in a different stage or part of the problem. In our example, this is presented as follows:<br />
<ul>
<li><strong>Signal Processing</strong> - The biggest job of number crunching the radar data (eg spectrogram analysis)&nbsp;into digital data
</li><li><strong>Image Recognition</strong> - Comparing the part processed image with known signatures
</li><li><strong>Plane Identification</strong> -&nbsp;&quot;Hand-shaking&quot; with onboard computers, requesting voice contact, checking flight paths -&nbsp;basically deciding if friend or foe
</li><li><strong>War Machine</strong> - if a Rocket or hostile Plane, the military take over and decide how best to deal with the target (Missile defense, scramble rapid response fighters)
</li></ul>
<p>They could be completely separate systems, located in separate places, communicating through secure services. However, all they would need to co-operate in the system is a shared/common interface, as outlined as an essential part of the Blackboard design
 pattern.</p>
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">public</code>
<code style="font-weight:bold;">interface</code> <code>
IKnowledgeSource</code></span></div>
<div><span><code>{</code></span></div>
<div><span><strong><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">bool</code>
<code>IsEnabled { </code><code style="font-weight:bold;">get</code><code>; }</code></span></strong></span></div>
<div><span><strong><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">void</code>
<code>Configure(Blackboard board);</code></span></strong></span></div>
<div><span><strong><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">void</code>
<code>ExecuteAction();</code></span></strong></span></div>
<div><span>&nbsp;</span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>KnowledgeSourceType KSType {
</code><code style="font-weight:bold;">get</code><code>; }</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>KnowledgeSourcePriority Priority {
</code><code style="font-weight:bold;">get</code><code>; }</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">void</code>
<code>Stop();</code></span></span></div>
<div><span><code>}</code></span></div>
</div>
<br />
The first three lines here are as per the Blackboard design pattern.
<ul>
<li><strong>IsEnabled</strong> is set if there are any problems that this Knowledge Base can execute upon.
</li><li><strong>Configure</strong> sets up any specific parameters or data that is offered by the controller to help solve the problem. In my multi-problem example it is not used, as each Knowledge Source interrogates the objects directly, from the Blackboard.
</li><li><strong>ExecuteAction</strong> is the method that makes the Knowledge Source perform &quot;do it&#39;s business&quot; on the problem(s)
</li></ul>
<h2><a name="Signal_Processor"></a><strong>Signal Processor</strong></h2>
<p>This is the first&nbsp;Knowledge&nbsp;Source to &quot;act upon the problem&quot;, in that it takes the raw radar data from the &quot;Incoming Objects&quot;, as presented on the Blackboard, in the CurrentObjects collection, which the radar is reporting to. As explained, this is by far
 the most processor intensive part of the system. <br />
<br />
To represent this,&nbsp;I have added a level of granularity into the signal processor, allowing it to only process one small &quot;block&quot; of pixels from a random square of the image. This means that if the random selection is unlucky, it can take many attempts, before
 the image processor returns enough to identify the object. This is&nbsp;demonstrated in the
<strong>ProcessAnotherBit</strong> method.</p>
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">public</code>
<code style="font-weight:bold;">override</code> <code style="font-weight:bold;">
bool</code> <code>IsEnabled</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">get</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>{</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">for</code>
<code>(var ix = 0; ix &lt; blackboard.CurrentObjects.Count(); ix&#43;&#43;)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">if</code>
<code>(blackboard.CurrentObjects[ix].Stage &lt; ProcessingStage.Analysed)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">return</code>
<code style="font-weight:bold;">true</code><code>;</code></span></span></div>
<div><span>&nbsp;</span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">return</code>
<code style="font-weight:bold;">false</code><code>;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>}</code></span></span></div>
<div><span><code>}</code></span></div>
<div><span>&nbsp;</span></div>
<div><span><code style="font-weight:bold;">public</code>
<code style="font-weight:bold;">override</code> <code style="font-weight:bold;">
void</code> <code>ExecuteAction()</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">for</code>
<code>(var ix = 0; ix &lt; blackboard.CurrentObjects.Count(); ix&#43;&#43;)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">if</code>
<code>(blackboard.CurrentObjects[ix].Stage &lt; ProcessingStage.Analysed)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>ProcessAnotherBit(blackboard.CurrentObjects[ix]);</code></span></span></div>
<div><span><code>}</code></span></div>
<div><span>&nbsp;</span></div>
<div><span><code style="font-weight:bold;">void</code>
<code>ProcessAnotherBit(IObject obj)</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">int</code>
<code>GRANULARITY = 16;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">int</code>
<code>blockWidth = obj.Image.PixelWidth / GRANULARITY;</code></span></span></div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<h3><a name="Copying_Betwen_WriteableBitmaps"></a><strong>Copying Between WriteableBitmaps</strong></h3>
<p>ProcessAnotherBit acts upon the image, which in WPF terms is a WriteableBitmap.
<br />
The method copies the known/shown image (to be worked upon) into an array of bytes, representing the image pixels.</p>
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">int</code>
<code>stride = obj.Image.PixelWidth * obj.Image.Format.BitsPerPixel / 8;</code></span></div>
<div><span><code style="font-weight:bold;">int</code>
<code>byteSize = stride * obj.Image.PixelHeight * obj.Image.Format.BitsPerPixel / 8;</code></span></div>
<div><span><code>var ary =
</code><code style="font-weight:bold;">new</code> <code style="font-weight:bold;">
byte</code><code>[byteSize];</code></span></div>
<div><span><code>obj.Image.CopyPixels(ary, stride, 0);</code></span></div>
</div>
<p>And a similar array for the&nbsp;hidden (to be analyzed)&nbsp;image:</p>
<div class="reCodeBlock">
<div><span><code>var unk = obj
</code><code style="font-weight:bold;">as</code> <code>
IncomingObject;</code></span></div>
<div><span><code>unk.GetActualObject().Image.CopyPixels(aryOrig, stride, 0);</code></span></div>
</div>
<p>It then chooses a random square from &quot;aryOrig&quot;&nbsp;and copies the pixels into the known/shown byte array&nbsp;&quot;ary&quot;:</p>
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">for</code>
<code>(var iy = 0; iy &lt; blockWidth; iy&#43;&#43;)</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">for</code>
<code>(var ix = 0; ix &lt; blockWidth; ix&#43;&#43;)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">for</code>
<code>(var b = 0; b &lt; 4; b&#43;&#43;)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>{</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>ary[curix] = aryOrig[curix];</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>curix&#43;&#43;;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>}</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>curix = curix &#43; stride - (blockWidth * 4);</code></span></span></div>
<div><span><code>}</code></span></div>
</div>
<p>And finally returns the updated array to the actual WriteableBitmap:</p>
<div class="reCodeBlock">
<div><span><code>obj.Image.WritePixels(</code><code style="font-weight:bold;">new</code>
<code>Int32Rect(0, 0, obj.Image.PixelWidth, obj.Image.PixelHeight), ary, stride, 0);</code></span></div>
</div>
<p>&nbsp;</p>
<h2><a name="Image_Recognition"></a><strong>Image Recognition</strong></h2>
<p>This knowledge Source is responsible for trying to figure out what the pixilated image is. This is done on every &quot;pass&quot; of the data, as the image takes form. Every time a block of pixels is added to the known image, it is compared against known images to
 see if it now only matches ONE of the images. Although not shown in this simple example, it could also&nbsp;trigger&nbsp;if all&nbsp;<em>remaining</em> images are hostile, allowing the War Machine to get involved before the image is even fully analyzed.</p>
<h3><a name="Comparing_Pixels"></a><strong>Comparing Pixels</strong></h3>
<p>This is an ugly piece of byte crunching code not worth documenting, except for the actual ARGB comparison:</p>
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">for</code>
<code>(var ix = 0; ix &lt; blockWidth; ix&#43;&#43;)</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>var argb1 = (ary[curix &#43; 1] * 256 * 256) &#43; (ary[curix &#43; 2] * 256) &#43; ary[curix &#43; 3];</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>var argb2 = (aryKnown[curix &#43; 1] * 256 * 256) &#43; (aryKnown[curix &#43; 2] * 256) &#43; aryKnown[curix &#43; 3];</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">if</code>
<code>(argb1 != 255 * 256 * 256 &amp;&amp; argb1 != argb2)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>{</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>nomatch =
</code><code style="font-weight:bold;">true</code><code>;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">break</code><code>;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>}</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>curix &#43;= 4;</code></span></span></div>
<div><span><code>}</code></span></div>
</div>
<p>As you can see, it is iterating through the array of bytes, pixel by pixel (4 bytes at a time). This code specifically checks the RGB values&nbsp;for a match.<br />
<br />
If the detection code finds only one match remains, then the data is retrieved&nbsp;for the hidden object, representing the &quot;found you&quot; moment, when you pull the relevant data from lookup databases, and potentially representing many other Knowledge Sources&nbsp;which&nbsp;may
 have been watching the Blackboard for such updates.</p>
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">if</code>
<code>(matches.Count() == 1)</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>obj.Type = matches[0].Type;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>obj.Name = matches[0].Name;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>obj.IsThreat = matches[0].IsThreat;</code></span></span></div>
<div><span>&nbsp;</span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>obj.Image =
</code><code style="font-weight:bold;">new</code> <code>
WriteableBitmap(matches[0].Image); </code><code>//Create new image instance</code></span></span></div>
<div><span>&nbsp;</span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">if</code>
<code>(obj.Type != ObjectType.Plane)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>obj.Stage = ProcessingStage.Identified;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">else</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>obj.Stage = ProcessingStage.Analysed;</code></span></span></div>
<div><span><code>}</code></span></div>
</div>
<p>&nbsp;</p>
<h2><a name="Plane_Identification"></a><strong>Plane Identification</strong></h2>
<p>This Knowledge Source is just an example of another analyzer layer that could process the data further. We have BirdObjects (safe) and RocketObjects (hostile) but we also have PlaneObjects, that could be either, depending on further analysis. In this module&#39;s
 Execute method, it emulates the process of further analysis, whether that be initiating a hand-shake protocol to onboard computer identification systems, a manual&nbsp;contact attempt&nbsp;from air traffic controllers, and checking the resulting data against&nbsp;published
 flight paths.<br />
<br />
This is a good example where a callback method would be used, as further analysis could take &quot;human time&quot;, which is of course, the slowest of all.
<br />
<br />
In this simple example, this is represented by further extraction of data from the hidden actual IObject, within the IncomingObject:</p>
<div class="reCodeBlock">
<div><span><code>for (var ix = 0; ix &lt; blackboard.CurrentObjects.Count(); ix&#43;&#43;)</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>var obj = blackboard.CurrentObjects[ix];</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>if (obj.Stage == ProcessingStage.Analysed &amp;&amp; obj.Type == ObjectType.Plane)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>{</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>var unk = obj as IncomingObject;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>var actual = unk.GetActualObject();</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>obj.Name = actual.Name;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>obj.IsThreat = actual.IsThreat;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>obj.Stage = ProcessingStage.Identified;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>}</code></span></span></div>
<div><span><code>}</code></span></div>
</div>
<p>&nbsp;</p>
<h2><a name="The_War_Machine"></a><strong>The War Machine!</strong></h2>
<p>This final Knowledge Source represents one possible &quot;solution&quot; to the problem :)<br />
<br />
To add extra &quot;peril&quot; to this example, it takes three seconds (passes) for the military to &quot;respond and react&quot; to an object that is identified and labeled as&nbsp;hostile.<br />
<br />
With each pass of the War Machine, each &#39;military response&#39;&nbsp;gets&nbsp;closer to it&#39;s target. This represents the delay it takes for Missile Defense Systems to respond,&nbsp;SAMs or &quot;rapid response&quot; type fighter jets to scramble and&nbsp;intercept the target.</p>
<h3><a name="Drawing_on_a_WriteableBitmap"></a><strong>Drawing on a WriteableBitmap</strong></h3>
<p>The &quot;final blow&quot; is represented by a little piece of WriteableBitmap manipulation, to draw a cross over the image:<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/2678.destroy.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/56x56/__key/communityserver-wikis-components-files/00-00-00-00-05/2678.destroy.png" style="border-width:0px;border-style:solid;" /></a></p>
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">public</code>
<code style="font-weight:bold;">override</code> <code style="font-weight:bold;">
void</code> <code>ExecuteAction()</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">for</code>
<code>(var ix = 0; ix &lt; blackboard.CurrentObjects.Count(); ix&#43;&#43;)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>{</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>var obj = blackboard.CurrentObjects[ix]
</code><code style="font-weight:bold;">as</code> <code>
IncomingObject;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">if</code>
<code>(obj.IsThreat != </code><code style="font-weight:bold;">null</code>
<code>&amp;&amp; obj.IsThreat.Value &amp;&amp; (obj.Stage != ProcessingStage.Actioned))</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>{</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">if</code>
<code>(obj.MoveHitsTarget())</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>DestroyTarget(obj);</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>}</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>}</code></span></span></div>
<div><span><code>}</code></span></div>
<div><span>&nbsp;</span></div>
<div><span><code style="font-weight:bold;">private</code>
<code style="font-weight:bold;">void</code> <code>
DestroyTarget(IncomingObject obj)</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">int</code>
<code>stride = obj.Image.PixelWidth * obj.Image.Format.BitsPerPixel / 8;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">int</code>
<code>byteSize = stride * obj.Image.PixelHeight * obj.Image.Format.BitsPerPixel / 8;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>var ary =
</code><code style="font-weight:bold;">new</code> <code style="font-weight:bold;">
byte</code><code>[byteSize];</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>obj.Image.CopyPixels(ary, stride, 0);</code></span></span></div>
<div><span>&nbsp;</span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>DrawCross(stride, ary);</code></span></span></div>
<div><span>&nbsp;</span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>obj.Image.WritePixels(</code><code style="font-weight:bold;">new</code>
<code>Int32Rect(0, 0, obj.Image.PixelWidth, obj.Image.PixelHeight), ary, stride, 0);</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>obj.Stage = ProcessingStage.Actioned;</code></span></span></div>
<div><span><code>}</code></span></div>
<div><span>&nbsp;</span></div>
<div><span><code style="font-weight:bold;">private</code>
<code style="font-weight:bold;">static</code> <code style="font-weight:bold;">
void</code> <code>DrawCross(</code><code style="font-weight:bold;">int</code>
<code>stride, </code><code style="font-weight:bold;">byte</code><code>[] ary)</code></span></div>
<div><span><code>{</code></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">for</code>
<code>(var y = 1; y &lt; 47; y&#43;&#43;)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>{</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>var line1Pos = (y * stride) &#43; (y * 4);</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>var line2Pos = (y * stride) &#43; (stride - 4) - (y * 4);</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="font-weight:bold;">for</code>
<code>(var a = -1; a &lt; 2; a&#43;&#43;)</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>{</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>ary[line1Pos &#43; 4 &#43; (a * 4)] = ary[line2Pos &#43; 4 &#43; (a * 4)] = 255;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>ary[line1Pos &#43; 5 &#43; (a * 4)] = ary[line2Pos &#43; 5 &#43; (a * 4)] = 0;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>ary[line1Pos &#43; 6 &#43; (a * 4)] = ary[line2Pos &#43; 6 &#43; (a * 4)] = 0;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>ary[line1Pos &#43; 7 &#43; (a * 4)] = ary[line2Pos &#43; 7 &#43; (a * 4)] = 0;</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>}</code></span></span></div>
<div><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code>}</code></span></span></div>
<div><span><code>}</code></span></div>
</div>
<p>&nbsp;</p>
<p>↑ <a href="#Top">Return to Top</a></p>
<hr />
<h1><a name="Blackboard_Extensibility"></a>Blackboard Extensibility</h1>
<p>Considering how long the Signal processor can take to process the radar data,&nbsp;added to&nbsp;the extra delay in hitting the targets, means some objects may not get processed in time.
<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/2112.tooclose.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/400x0/__key/communityserver-wikis-components-files/00-00-00-00-05/2112.tooclose.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
This is of course unacceptable in such a system, so it would need to expand,&nbsp;grow with demand. As our controller is simply iterating over a list of known Knowledge Sources, it is a simple matter of adding to that collection. This is demonstrated with the &quot;Add
 another signal processor&quot; button. each click of this adds extra processing power to each loop of the controller, and after just a few clicks, you will see the images getting identified within just a few iterations.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7658.moreprocessors.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/400x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7658.moreprocessors.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<strong>This represents one of the main selling points of this design pattern. <br />
<br />
Extra Knowledge Sources will also bring their own priority attributes, allowing it to slip into the collection at whatever priority is&nbsp;required.
<br />
<br />
This is&nbsp;also why&nbsp;the Controller is needed, to centralize the decision process and mediate between multiple Knowledge Sources.</strong></p>
<p>&nbsp;</p>
<p>↑ <a href="#Top">Return to Top</a></p>
<hr />
<h1><a name="Download_and_Try"></a>Download and Try!</h1>
<p><span style="font-size:10px;">This project is available for download and further study in the TechNet Gallery:</span><br />
<br />
<a href="http://gallery.technet.microsoft.com/Blackboard-Design-Pattern-13a35a7e"><strong><span style="font-size:14px;">http://gallery.technet.microsoft.com/Blackboard-Design-Pattern-13a35a7e</span></strong></a><br />
<br />
</p>
<p>↑ <a href="#Top">Return to Top</a></p>
<hr />
<h1><a name="See_Also"></a>See Also</h1>
<span style="font-size:10px;">Links to domain parent articles and related articles in TechNet Wiki.</span>
<ul>
<li><a href="http://social.technet.microsoft.com/wiki/contents/articles/18030.software-patterns-practices.aspx" target="_blank">Software Patterns and Practices</a>
</li><li><a href="http://social.technet.microsoft.com/wiki/contents/articles/13209.behavioral-design-pattern.aspx">Behavioral Design Pattern</a>
</li></ul>
<p>&nbsp;</p>
<p>&nbsp;</p>

</div>
    
    
