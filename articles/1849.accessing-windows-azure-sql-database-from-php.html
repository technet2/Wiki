---
layout: default
title: 'Accessing Windows Azure SQL Database From PHP - TechNet Articles - United States (English) - TechNet Wiki'
weight: 3
---

<div class="post-content user-defined-markup">

<span style="font-size:11pt;font-family:calibri,sans-serif;">This example uses the
</span><a href="http://us3.php.net/manual/en/book.uodbc.php" target="_blank"><span style="font-size:11pt;font-family:calibri,sans-serif;">unified ODBC suppor-6615">
<div class="content-fragment-inner fiji-content-fragment-inner"><div class="content-fragment-top fiji-content-fragment-top"><div class="r1 fiji-r1"></div><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div><div class="content-fragment-content">

<div class="full-post-header"></div>
<div class="full-post">
    <h1 class="post-name">Accessing Windows Azure SQL Database From PHP</h1>
    <div class="post-rating"><span id="ctl00_ctl00_cot</span></a><span style="font-size:11pt;font-family:calibri,sans-serif;"> built in to PHP to interact
 with SDS.&nbsp;&nbsp;&nbsp; I’ve included a sample code snippet below which uses the Windows Azure SQL Database server
<em></em><em>database.windows.net</em>:<br />
<br />
</span>
<div style="background-color:#d9d9d9;padding:1pt 4pt;border:1pt solid windowtext;">
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;color:#0000ff;">&lt;?php</span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;"><strong><span>&nbsp;
</span>$host</strong> </span><strong><span style="color:purple;">=</span></strong><span style="color:#0000ff;">
</span><span style="color:olive;">&quot;database.windows.net&quot;</span><span style="color:#0000ff;">;</span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;"><strong><span>&nbsp;
</span>$dbname</strong> </span><strong><span style="color:purple;">=</span></strong><span style="color:#0000ff;">
</span><span style="color:olive;">&quot;database&quot;</span><span style="color:#0000ff;">;</span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;"><strong><span>&nbsp;
</span>$dbuser</strong> </span><strong><span style="color:purple;">=</span></strong><span style="color:#0000ff;">
</span><span style="color:olive;">&quot;user@server&quot;</span><span style="color:#0000ff;">;</span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;"><strong><span>&nbsp;
</span>$dbpwd</strong> </span><strong><span style="color:purple;">=</span></strong><span style="color:#0000ff;">
</span><span style="color:olive;">&quot;password&quot;</span><span style="color:#0000ff;">;</span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;"><strong><span>&nbsp;
</span>$driver</strong> </span><strong><span style="color:purple;">=</span></strong><span style="color:#0000ff;">
</span><span style="color:olive;">&quot;{SQL Server Native Client 10.0}&quot;</span></span><span style="font-family:&#39;courier new&#39;;color:#0000ff;">;<br />
<br />
<strong></strong></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;color:green;">&nbsp; // Build connection string</span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><strong><span style="color:#0000ff;">&nbsp; $dsn</span></strong><strong><span style="color:purple;">=</span></strong><span style="color:olive;">&quot;Driver=</span><strong><span style="color:#0000ff;">$driver</span></strong><span style="color:olive;">;Server=</span><strong><span style="color:#0000ff;">$host</span></strong><span style="color:olive;">;Database=</span><strong><span style="color:#0000ff;">$dbname</span></strong><span style="color:olive;">;Encrypt=true;TrustServerCertificate=true&quot;;</span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;">&nbsp; if
</span><strong><span style="color:purple;">(!(</span><span style="color:#0000ff;">$conn</span></strong><span style="color:#0000ff;">
</span><strong><span style="color:purple;">=</span></strong><span style="color:#0000ff;">
</span><strong><span style="color:purple;">@</span></strong><span style="color:#0000ff;">odbc_connect</span><span style="color:#000000;">(</span><strong><span style="color:#0000ff;">$dsn</span></strong><strong><span style="color:#000000;">,</span></strong><strong><span style="color:purple;">
</span><span style="color:#0000ff;">$dbuser</span></strong><strong><span style="color:purple;">,</span></strong><span style="color:#0000ff;">
<strong>$dbpwd</strong></span><strong><span style="color:purple;">))) {</span></strong><span style="color:purple;"></span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; die</span><strong><span style="color:purple;">(</span></strong><span style="color:olive;">&quot;Connection error: &quot;</span><span style="color:#0000ff;">
</span><strong><span style="color:purple;">.</span></strong><span style="color:#0000ff;"> odbc_errormsg</span><strong><span style="color:purple;">())</span></strong><span style="color:#0000ff;">;</span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><strong><span style="color:purple;">&nbsp; }</span></strong><span style="color:purple;"></span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="color:purple;font-family:&#39;courier new&#39;;">&nbsp;</span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;color:green;">&nbsp; // Got a connection, run simple query</span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;">&nbsp; if
</span><strong><span style="color:purple;">(</span><span style="color:#0000ff;">$qh</span></strong><span style="color:#0000ff;">
</span><strong><span style="color:purple;">=</span></strong><span style="color:#0000ff;">
</span><strong><span style="color:purple;">@</span></strong><span style="color:#0000ff;">odbc_exec</span><strong><span style="color:purple;">(</span><span style="color:#0000ff;">$conn</span></strong><strong><span style="color:purple;">,</span></strong><span stypan style="color:purple;">&nbsp; }</span></strong><span style="color:purple;"></span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="color:purple;font-family:&#39;courier new&#39;;">&nbsp;</span></p>le="color:#0000ff;">
</span><span style="color:olive;">&quot;SELECT A, B FROM myTable&quot;</span><strong><span style="color:purple;">)) {</span></strong><span style="color:purple;"></span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;color:green;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Dump query result</span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<strong>$rows</strong> </span><strong><span style="color:purple;">=</span></strong><span style="color:#0000ff;">
</span><span style="color:red;">0</span><span style="color:#0000ff;">;</span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while
</span><strong><span style="color:purple;">(</span></strong><span style="color:#0000ff;">
<strong>$row</strong> </span><strong><span style="color:purple;">=</span></strong><span style="color:#0000ff;">
</span><strong><span style="color:purple;">@</span></strong><span style="color:#0000ff;">odbc_fetch_object</span><strong><span style="color:purple;">(</span><span style="color:#0000ff;">$qh</span></strong><strong><span style="color:purple;">)</span></strong><span style="color:#0000ff;">
</span><strong><span style="color:purple;">)</span></strong><span style="color:#0000ff;">
</span><strong><span style="color:purple;">{</span></strong><span style="color:purple;"></span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo</span><strong><span style="color:purple;">(</span></strong><span style="color:olive;">&quot;</span><strong><span style="color:#0000ff;">$rows</span></strong><span style="color:olive;">:
</span><strong><span style="color:#0000ff;">$row</span></strong><span style="color:olive;">-&gt;A
</span><strong><span style="color:#0000ff;">$row</span></strong><span style="color:olive;">-&gt;B\r\n&quot;</span><strong><span style="color:purple;">)</span></strong><span style="color:#0000ff;">;</span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<strong>$rows</strong></span><strong><span style="color:purple;">&#43;&#43;</span></strong><span style="color:#0000ff;">;</span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<strong><span style="color:purple;">}</span></strong><span style="color:purple;"></span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<strong><span style="color:purple;">@</span></strong><span style="color:#0000ff;">odbc_free_result</span><strong><span style="color:purple;">(</span><span style="color:#0000ff;">$qh</span></strong><strong><span style="color:purple;">)</span></strong><span style="color:#0000ff;">;</span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><strong><span style="color:purple;">&nbsp; }</span></strong><span style="color:purple;"></span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;">&nbsp; else
</span><strong><span style="color:purple;">{</span></strong><span style="color:purple;"></span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;color:green;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Error running query</span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><span style="color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo</span><strong><span style="color:purple;">(</span></strong><span style="color:olive;">&quot;Query error: &quot;</span><span style="color:#0000ff;">
</span><strong><span style="color:purple;">.</span></strong><span style="color:#0000ff;"> odbc_errormsg</span><strong><span style="color:purple;">(</span><span style="color:#0000ff;">$conn</span></strong><strong><span style="color:purple;">))</span></strong><span style="color:#0000ff;">;</span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><strong><span style="color:purple;">&nbsp; }</span></strong><span style="color:purple;"></span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="color:purple;font-family:&#39;courier new&#39;;">&nbsp;</span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;color:green;">&nbsp; // Free the connection</span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;"><strong><span style="color:purple;">&nbsp; @</span></strong><span style="color:#0000ff;">odbc_close</span><strong><span style="color:purple;">(</span><span style="color:#0000ff;">$conn</span></strong><strong><span style="color:purple;">)</span></strong><span style="color:#0000ff;">;</span></span></p>
<p class="Code" style="margin:0in 0in 0pt;"><span style="font-family:&#39;courier new&#39;;color:#0000ff;">?&gt;</span></p>
</div>
<p><span style="font-size:11pt;font-family:calibri,sans-serif;">In this example, I’m using the
</span><a href="http://msdn.microsoft.com/en-us/data/aa937733.aspx"><span style="font-size:11pt;font-family:calibri,sans-serif;">SQL Server native ODBC driver</span></a><span style="font-size:11pt;font-family:calibri,sans-serif;"> which ships out of band from
 the operating system.&nbsp;&nbsp;&nbsp; Other driver choices may be used as outlined in the table below.</span></p>
<table class="MsoTableMediumShading1Accent1" border="1" cellspacing="0" cellpadding="0" style="border:currentcolor;border-collapse:collapse;">
<tbody>
<tr>
<td valign="top" style="background-color:#4f81bd;padding:0in 5.4pt;width:63.9pt;">
<p><strong><span style="font-size:11pt;font-family:calibri,sans-serif;color:white;">Item</span></strong></p>
</td>
<td valign="top" style="background-color:#4f81bd;padding:0in 5.4pt;width:333pt;">
<p><strong><span style="font-size:11pt;font-family:calibri,sans-serif;color:white;">Comments</span></strong></p>
</td>
</tr>
<tr>
<td valign="top" style="background-color:#d3dfee;padding:0in 5.4pt;width:63.9pt;">
<p><strong><span style="font-size:11pt;font-family:calibri,sans-serif;">Server</span></strong></p>
</td>
<td valign="top" style="background-color:#d3dfee;padding:0in 5.4pt;width:333pt;">
<p><span style="font-size:11pt;font-family:calibri,sans-serif;">Name of the virtual SQL Database data server to connect to.&nbsp;&nbsp; This takes the form of
<strong><em>servername</em></strong><em>.</em><span style="font-size:11pt;font-family:calibri,sans-serif;"><em>database.windows.net</em></span>.&nbsp;&nbsp; In the example, I’m using a virtual server provisioned in the SDS pre-production domain
<em>database.windows.net</em></span></p>
</td>
</tr>
<tr>
<td valign="top" style="padding:0in 5.4pt;width:63.9pt;background-color:transparent;">
<p><strong><span style="font-size:11pt;font-family:calibri,sans-serif;">Driver</span></strong></p>
</td>
<td valign="top" style="padding:0in 5.4pt;width:333pt;background-color:transparent;">
<p><span style="font-size:11pt;font-family:calibri,sans-serif;">ODBC driver to use:<br />
<em><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{SQL Server}</em> – Legacy SQL Server driver<br />
<em><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{SQL Native Client}</em> – <a href="http://msdn.microsoft.com/sv-se/library/ms131415%28en-us,SQL.90%29.aspx">
SQL 2005 Native Client</a><br />
<em><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{SQL Server Native Client 10.0}</em> – <a href="http://msdn.microsoft.com/sv-se/library/ms131415%28en-us%29.aspx">
SQL 2008 Native Client</a></span></p>
</td>
</tr>
<tr>
<td valign="top" style="background-color:#d3dfee;padding:0in 5.4pt;width:63.9pt;">
<p><strong><span style="font-size:11pt;font-family:calibri,sans-serif;">Database</span></strong></p>
</td>
<td valign="top" style="background-color:#d3dfee;padding:0in 5.4pt;width:333pt;">
<p><span style="font-size:11pt;font-family:calibri,sans-serif;">Name of the target database to connect to.&nbsp;&nbsp; If left unspecified the connection will default to the
<em>master</em> database.</span></p>
</td>
</tr>
<tr>
<td valign="top" style="padding:0in 5.4pt;width:63.9pt;background-color:transparent;">
<p><strong><span style="font-size:11pt;font-family:calibri,sans-serif;">Encrypt</span></strong></p>
</td>
<td valign="top" style="padding:0in 5.4pt;width:333pt;background-color:transparent;">
<p><span style="font-size:11pt;font-family:calibri,sans-serif;">Force use of encryption over TDS – if left unspecified, SQL Database will force encryption</span></p>
</td>
</tr>
<tr>
<td valign="top" style="background-color:#d3dfee;padding:0in 5.4pt;width:63.9pt;">
<p><strong><span style="font-size:11pt;font-family:calibri,sans-serif;">TrustServerCertificate</span></strong></p>
</td>
<td valign="top" style="background-color:#d3dfee;padding:0in 5.4pt;width:333pt;">
<p><span style="font-size:11pt;font-family:calibri,sans-serif;">Trust the certificate returned by the data service – this is currently required due to implementation restrictions that will be relaxed before we release
</span></p>
</td>
</tr>
<tr>
<td valign="top" style="padding:0in 5.4pt;width:63.9pt;background-color:transparent;">
<p><strong><span style="font-size:11pt;font-family:calibri,sans-serif;">UID</span></strong></p>
</td>
<td valign="top" style="padding:0in 5.4pt;width:333pt;background-color:transparent;">
<p><span style="font-size:11pt;font-family:calibri,sans-serif;">Username of the user – form should be
<em>user@server.<span>&nbsp;&nbsp; </span></em>Can be specified in the connection string or as argument to odbc_connect()</span></p>
</td>
</tr>
<tr>
<td valign="top" style="background-color:#d3dfee;padding:0in 5.4pt;width:63.9pt;">
<p><strong><span style="font-size:11pt;font-family:calibri,sans-serif;">PWD</span></strongfee;padding:0in 5.4pt;width:333pt;">
<p><span style="font-size:11pt;font-family:calibri,sans-serif;">Trust the certificate returned by the data service – this is currently required due to implementation restrictions that will be relaxed before we release
</span></p>
</td>
</tr>
<tr>
<td valign="top" style="padding:0in 5.4pt;width:63.9pt;background-color:transparent;">
<p><strong><span style="font-size:1></p>
</td>
<td valign="top" style="background-color:#d3dfee;padding:0in 5.4pt;width:333pt;">
<p><span style="font-size:11pt;font-family:calibri,sans-serif;">Password of the user account.&nbsp; Can be specified in the connection string or as argument to odbc_connect()</span></p>
</td>
</tr>
</tbody>
</table>
<p><span style="font-size:11pt;font-family:calibri,sans-serif;">For those familiar with ODBC you’ll note this pattern is also used to connect to a regular SQL Server instance.&nbsp;&nbsp; The only change in the code is the name of the server, use of encryption and the
 use of SQL standard security (username and password). </span></p>
<p><span style="font-size:11pt;font-family:calibri,sans-serif;">In addition to the ODBC driver patterns, there is an open source
</span><a href="http://www.microsoft.com/sqlserver/2005/en/us/PHP-Driver.aspx"><span style="font-size:11pt;font-family:calibri,sans-serif;">Native PHP driver for SQL Server</span></a><span style="font-size:11pt;font-family:calibri,sans-serif;">.&nbsp; This driver
 is a native client library built over the </span><a href="http://msdn.microsoft.com/sv-se/library/ms131415%28en-us,SQL.90%29.aspx"><span style="font-size:11pt;font-family:calibri,sans-serif;">SQL 2005 Native Client</span></a><span style="font-size:11pt;font-family:calibri,sans-serif;">.&nbsp;&nbsp;&nbsp;
</span><span style="font-size:11pt;font-family:calibri,sans-serif;"><br />
</span></p>
<p><span style="font-size:11pt;font-family:calibri,sans-serif;">You see the patterns used to access SDS are identical to those you use to access SQL Server.&nbsp;&nbsp;
</span></p>
<p><span style="font-size:11pt;font-family:calibri,sans-serif;"><br />
</span></p>

</div>
    
    
